<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Rancho Control</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#8B4513" />
    <link rel="apple-touch-icon" href="icon.png" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
      <div
        class="container-fluid d-flex justify-content-between align-items-center"
      >
        <a class="navbar-brand fw-bold" href="#">
          <i class="fa-solid fa-horse-head me-1"></i>
          <span id="brandName">Rancho Control</span>
        </a>
        <div class="d-flex gap-2 align-items-center">
          <button
            id="btnInstalarApp"
            class="btn btn-sm btn-outline-light d-none fw-bold"
            style="border-radius: 20px"
          >
            <i class="fa-solid fa-download me-1"></i>
            <span class="d-none d-md-inline">Instalar</span>
          </button>
          <button
            class="btn btn-sm text-white-50"
            onclick="RanchoApp.abrirModalConfig()"
          >
            <i class="fa-solid fa-gear fs-5"></i>
          </button>
          <button id="logoutButton" class="btn btn-sm text-white-50">
            <i class="fa-solid fa-right-from-bracket fs-5"></i>
          </button>
        </div>
      </div>
    </nav>

    <main class="container">
      <div class="mt-3">
        <h6
          class="text-muted small fw-bold ms-1 mb-2 text-uppercase"
          style="color: #8d6e63 !important"
        >
          Resumo
        </h6>
        <div class="scrolling-wrapper">
          <div class="card-resumo-mini">
            <div class="d-flex justify-content-between align-items-start">
              <i
                class="fa-solid fa-horse-head text-primary fs-3 mb-2"
                style="opacity: 0.8"
              ></i>
            </div>
            <h3 class="fw-bold mb-0" id="totalCavalos">0</h3>
            <small class="text-muted fw-bold" style="font-size: 0.75rem"
              >ANIMAIS</small
            >
          </div>
          <div class="card-resumo-mini">
            <div class="d-flex justify-content-between align-items-start">
              <i
                class="fa-solid fa-hat-cowboy text-secondary fs-3 mb-2"
                style="opacity: 0.8"
              ></i>
            </div>
            <h3 class="fw-bold mb-0" id="totalProprietarios">0</h3>
            <small class="text-muted fw-bold" style="font-size: 0.75rem"
              >CLIENTES</small
            >
          </div>
        </div>
      </div>

      <div class="mt-4 mb-3">
        <div
          class="input-group shadow-sm"
          style="
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(139, 69, 19, 0.1);
          "
        >
          <span class="input-group-text bg-white border-0 ps-3"
            ><i
              class="fa-solid fa-magnifying-glass"
              style="color: var(--cor-primaria)"
            ></i
          ></span>
          <input
            type="text"
            class="form-control border-0 py-3"
            id="inputBusca"
            placeholder="Buscar..."
            style="background: white"
          />
        </div>
      </div>

      <div class="d-flex gap-2 mb-3 overflow-auto pb-1">
        <button
          class="btn btn-primary rounded-pill px-4 fw-bold flex-grow-1"
          id="btnTabCavalos"
          onclick="RanchoApp.mudarAba('cavalos')"
        >
          <i class="fa-solid fa-horse me-1"></i> Animais
        </button>
        <button
          class="btn btn-light bg-white border text-secondary rounded-pill px-4 fw-bold flex-grow-1"
          id="btnTabProprietarios"
          onclick="RanchoApp.mudarAba('proprietarios')"
        >
          <i class="fa-solid fa-users me-1"></i> Clientes
        </button>
      </div>

      <div class="table-container pb-5">
        <div id="tabCavalos">
          <div class="table-responsive">
            <table class="table table-borderless align-middle">
              <tbody id="listaCavalosBody"></tbody>
            </table>
          </div>
        </div>
        <div id="tabProprietarios" class="d-none">
          <div class="table-responsive">
            <table class="table table-borderless align-middle">
              <tbody id="listaProprietariosMainBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <div class="fab-container" onclick="this.classList.toggle('active')">
      <div class="fab-options">
        <button
          class="fab-btn-mini"
          onclick="RanchoApp.abrirModalGerenciarProprietarios()"
        >
          <i class="fa-solid fa-user-plus"></i> Novo Dono
        </button>
        <button class="fab-btn-mini" onclick="RanchoApp.abrirModalNovoCavalo()">
          <i class="fa-solid fa-horse"></i> Novo Cavalo
        </button>
      </div>
      <button class="fab-main"><i class="fa-solid fa-plus"></i></button>
    </div>

    <div class="modal fade" id="modalConfig" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title fw-bold text-brown">Configurações</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="formConfig">
              <div class="mb-3">
                <label class="fw-bold small text-muted">NOME DO RANCHO</label>
                <input
                  type="text"
                  class="form-control"
                  id="configNomeRancho"
                  required
                />
              </div>
              <div class="d-grid">
                <button
                  type="submit"
                  class="btn btn-primary fw-bold"
                  id="btnSalvarConfig"
                >
                  Salvar Alterações
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalProprietario" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content" id="modalPropContent">
          <div class="modal-header border-0">
            <h5 class="modal-title fw-bold text-brown" id="tituloModalProp">
              Novo Proprietário
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body pt-0">
            <div class="bg-white p-4 rounded-4 shadow-sm">
              <form id="formProprietario">
                <input type="hidden" id="propId" />
                <div class="mb-3">
                  <label class="fw-bold small text-muted">NOME</label>
                  <input
                    type="text"
                    class="form-control form-control-lg fw-bold"
                    id="propNome"
                    required
                    style="color: var(--cor-primaria)"
                  />
                </div>
                <div class="mb-3">
                  <label class="fw-bold small text-muted">TELEFONE</label>
                  <input
                    type="tel"
                    class="form-control"
                    id="propTelefone"
                    placeholder="(DDD) 99999-9999"
                    maxlength="15"
                  />
                </div>
                <div
                  class="d-flex justify-content-between align-items-center pt-3 border-top mt-4"
                >
                  <button
                    type="button"
                    id="btnExcluirProp"
                    class="btn btn-link text-danger text-decoration-none p-0 d-none"
                    onclick="RanchoApp.excluirProprietarioAtual()"
                  >
                    <i class="fa-solid fa-trash"></i> Excluir
                  </button>
                  <div class="d-flex gap-2 ms-auto">
                    <button
                      type="button"
                      class="btn btn-light"
                      data-bs-dismiss="modal"
                    >
                      Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary fw-bold px-4">
                      Salvar
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalCavalo" tabindex="-1">
      <div
        class="modal-dialog modal-dialog-scrollable modal-fullscreen-sm-down"
      >
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title fw-bold text-brown" id="tituloModalCavalo">
              Ficha do Animal
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body p-4">
            <form id="formCavalo">
              <input type="hidden" id="cavaloId" />

              <div class="mb-3">
                <label class="fw-bold small text-muted">NOME DO ANIMAL</label>
                <input
                  type="text"
                  class="form-control form-control-lg fw-bold"
                  id="cavaloNome"
                  required
                  style="color: var(--cor-primaria)"
                />
              </div>

              <div class="row mb-3">
                <div class="col-6">
                  <label class="fw-bold small text-muted">BAIA/LOCAL</label>
                  <input type="text" class="form-control" id="cavaloLugar" />
                </div>
                <div class="col-6">
                  <label class="fw-bold small text-muted">DONO</label>
                  <select
                    class="form-select"
                    id="cavaloProprietario"
                    required
                  ></select>
                </div>
              </div>

              <div class="mb-3">
                <label class="fw-bold small text-muted">OBSERVAÇÕES</label>
                <textarea
                  class="form-control"
                  id="cavaloObs"
                  rows="3"
                ></textarea>
              </div>

              <div
                class="d-flex justify-content-between align-items-center pt-3 border-top mt-3"
              >
                <button
                  type="button"
                  id="btnExcluirCavalo"
                  class="btn btn-link text-danger text-decoration-none p-0 d-none"
                  onclick="RanchoApp.excluirCavaloAtual()"
                >
                  <i class="fa-solid fa-trash"></i> Excluir Animal
                </button>
                <div class="d-flex gap-2 ms-auto">
                  <button
                    type="button"
                    class="btn btn-light"
                    data-bs-dismiss="modal"
                  >
                    Cancelar
                  </button>
                  <button type="submit" class="btn btn-primary fw-bold px-4">
                    Salvar
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalFinanceiro" tabindex="-1">
      <div
        class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"
      >
        <div class="modal-content" id="modalFinContent">
          <div class="modal-header border-0">
            <h5 class="modal-title fw-bold text-brown" id="tituloModalFin">
              Financeiro
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body p-0">
            <div class="bg-white p-3 shadow-sm mb-2">
              <form id="formCusto" class="row g-2 align-items-center">
                <input type="hidden" id="custoIdEdit" />
                <div class="col-12">
                  <input
                    type="text"
                    class="form-control"
                    id="custoDesc"
                    placeholder="Descrição (Ex: Ração)"
                    required
                  />
                </div>
                <div class="col-5">
                  <select
                    class="form-select"
                    id="custoCat"
                    required
                    style="font-size: 0.9rem"
                  >
                    <option value="" selected disabled>Tipo</option>
                    <option value="Ração">Ração</option>
                    <option value="Ferragem">Ferragem</option>
                    <option value="Medicamento">Medicamento</option>
                    <option value="Veterinário">Veterinário</option>
                    <option value="Transporte">Transporte</option>
                    <option value="Outros">Outros</option>
                  </select>
                </div>
                <div class="col-5">
                  <input
                    type="text"
                    inputmode="decimal"
                    class="form-control"
                    id="custoValor"
                    placeholder="R$ 0,00"
                    required
                  />
                </div>
                <div class="col-2">
                  <button
                    type="submit"
                    id="btnSalvarCusto"
                    class="btn btn-success w-100 rounded-3"
                  >
                    <i class="fa-solid fa-plus"></i>
                  </button>
                </div>
              </form>
            </div>

            <input type="hidden" id="finCavaloId" />

            <div
              class="d-flex align-items-center justify-content-between px-3 py-2"
            >
              <div class="d-flex align-items-center gap-2">
                <button
                  class="btn btn-link text-decoration-none text-secondary p-0"
                  onclick="RanchoApp.mudarMes(-1)"
                >
                  <i class="fa-solid fa-chevron-left"></i>
                </button>
                <span
                  class="fw-bold text-primary small"
                  id="labelMesAno"
                  style="min-width: 100px; text-align: center"
                  >JANEIRO 2026</span
                >
                <button
                  class="btn btn-link text-decoration-none text-secondary p-0"
                  onclick="RanchoApp.mudarMes(1)"
                >
                  <i class="fa-solid fa-chevron-right"></i>
                </button>
              </div>
              <button
                class="btn btn-sm btn-outline-danger rounded-pill px-3 fw-bold"
                onclick="RanchoApp.gerarPDF()"
              >
                <i class="fa-solid fa-file-pdf me-1"></i> PDF
              </button>
            </div>

            <div class="px-3 pb-2" id="areaGrafico" style="display: none">
              <div
                class="bg-white rounded-4 shadow-sm p-3 mb-2 d-flex justify-content-center"
              >
                <div style="height: 180px; width: 100%; position: relative">
                  <canvas id="graficoFinanceiro"></canvas>
                </div>
              </div>
            </div>

            <div class="px-3 pb-3">
              <div class="bg-white rounded-4 shadow-sm overflow-hidden">
                <table class="table mb-0">
                  <tbody id="tabelaCustosBody"></tbody>
                </table>
              </div>
            </div>

            <div class="p-3 bg-white border-top text-center">
              <div class="text-muted small text-uppercase">Total do Mês</div>
              <div class="text-danger fw-bold fs-2" id="totalGastoModal">
                R$ 0,00
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalMensalidade" tabindex="-1">
      <div
        class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down"
      >
        <div class="modal-content" style="background-color: #e3f2fd">
          <div class="modal-header border-0">
            <h5
              class="modal-title fw-bold text-primary"
              id="tituloModalMensalidade"
            >
              Mensalidades
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body p-0">
            <div class="bg-white p-3 shadow-sm mb-3">
              <h6 class="small text-muted fw-bold mb-2">REGISTRAR PAGAMENTO</h6>
              <form id="formMensalidade">
                <input type="hidden" id="mensalidadeCavaloId" />
                <div class="row g-2 mb-2">
                  <div class="col-6">
                    <select class="form-select" id="mensalidadeMes" required>
                      <option value="" disabled selected>Mês</option>
                      <option value="1">Janeiro</option>
                      <option value="2">Fevereiro</option>
                      <option value="3">Março</option>
                      <option value="4">Abril</option>
                      <option value="5">Maio</option>
                      <option value="6">Junho</option>
                      <option value="7">Julho</option>
                      <option value="8">Agosto</option>
                      <option value="9">Setembro</option>
                      <option value="10">Outubro</option>
                      <option value="11">Novembro</option>
                      <option value="12">Dezembro</option>
                    </select>
                  </div>
                  <div class="col-6">
                    <select class="form-select" id="mensalidadeAno" required>
                      <option value="2025">2025</option>
                      <option value="2026" selected>2026</option>
                      <option value="2027">2027</option>
                    </select>
                  </div>
                  <div class="col-6">
                    <input
                      type="date"
                      class="form-control"
                      id="mensalidadeData"
                      required
                    />
                  </div>
                  <div class="col-6">
                    <input
                      type="text"
                      inputmode="decimal"
                      class="form-control"
                      id="mensalidadeValor"
                      placeholder="Valor (R$)"
                      required
                    />
                  </div>
                </div>
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary fw-bold">
                    <i class="fa-solid fa-check me-2"></i> Confirmar Pagamento
                  </button>
                </div>
              </form>
            </div>

            <div class="px-3 pb-3">
              <h6 class="small text-muted fw-bold ms-1 mb-2">
                HISTÓRICO DE PAGAMENTOS
              </h6>
              <div class="bg-white rounded-4 shadow-sm overflow-hidden">
                <table class="table mb-0 align-middle">
                  <tbody id="tabelaMensalidadeBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalDetalhesProprietario" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content">
          <div class="modal-header border-0 bg-white">
            <div>
              <h5 class="modal-title fw-bold text-dark" id="tituloDetalhesProp">
                Nome do Dono
              </h5>
              <small class="text-muted" id="subtituloDetalhesProp"
                >Resumo Financeiro</small
              >
            </div>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body p-0">
            <div class="bg-white p-3 border-bottom shadow-sm mb-2">
              <form id="formCustoProp" class="row g-2 align-items-center">
                <input type="hidden" id="custoPropIdEdit" />
                <div class="col-12">
                  <input
                    type="text"
                    class="form-control"
                    id="custoPropDesc"
                    placeholder="Descrição (Ex: Aula Avulsa)"
                    required
                  />
                </div>
                <div class="col-8">
                  <input
                    type="text"
                    inputmode="decimal"
                    class="form-control"
                    id="custoPropValor"
                    placeholder="Valor (R$)"
                    required
                  />
                </div>
                <div class="col-4">
                  <button
                    type="submit"
                    id="btnSalvarCustoProp"
                    class="btn btn-success w-100 rounded-3"
                  >
                    <i class="fa-solid fa-plus"></i>
                  </button>
                </div>
              </form>
            </div>
            <div
              class="d-flex align-items-center justify-content-center gap-3 py-2"
            >
              <button
                class="btn btn-link text-decoration-none text-secondary"
                onclick="RanchoApp.mudarMesProp(-1)"
              >
                <i class="fa-solid fa-chevron-left"></i>
              </button>
              <span
                class="fw-bold text-primary small text-uppercase"
                id="labelMesAnoProp"
                >JANEIRO 2026</span
              >
              <button
                class="btn btn-link text-decoration-none text-secondary"
                onclick="RanchoApp.mudarMesProp(1)"
              >
                <i class="fa-solid fa-chevron-right"></i>
              </button>
            </div>
            <div class="p-3">
              <div class="bg-white rounded-4 shadow-sm overflow-hidden">
                <table class="table mb-0 align-middle">
                  <tbody id="listaCavalosPropBody"></tbody>
                </table>
              </div>
            </div>
            <div class="px-3 pb-3">
              <div
                class="bg-white p-3 rounded-4 shadow-sm border border-danger border-opacity-25 text-center"
              >
                <div
                  class="display-6 fw-bold text-danger mt-1"
                  id="totalGeralProp"
                >
                  R$ 0,00
                </div>
              </div>
            </div>
            <div class="d-grid gap-2 p-3 pt-0">
              <button
                class="btn btn-primary py-3 fw-bold rounded-4 shadow-sm"
                id="btnBaixarFatura"
                onclick="RanchoApp.baixarFaturaMes()"
              >
                <i class="fa-solid fa-check-circle me-2 fs-5"></i> Confirmar
                Recebimento
              </button>
              <button
                class="btn btn-success py-2 fw-bold rounded-4"
                id="btnZapCobranca"
              >
                <i class="fa-brands fa-whatsapp me-2"></i> Enviar Cobrança
              </button>
              <button
                class="btn btn-outline-dark py-2 rounded-4"
                onclick="RanchoApp.gerarPDFProprietario()"
              >
                <i class="fa-solid fa-file-pdf me-2"></i> Relatório PDF
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalConfirmacao" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title fw-bold text-danger" id="tituloConfirmacao">
              Confirmação
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body text-center py-4">
            <i
              class="fa-solid fa-circle-exclamation text-warning display-4 mb-3"
            ></i>
            <p id="msgConfirmacao" class="fs-5 text-dark mb-0">Tem certeza?</p>
          </div>
          <div class="modal-footer border-0 justify-content-center">
            <button
              type="button"
              class="btn btn-light rounded-pill px-4"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              id="btnConfirmarAcao"
              class="btn btn-danger rounded-pill px-4 fw-bold"
            >
              Sim, Confirmar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="toast-container position-fixed bottom-0 end-0 p-3"
      style="z-index: 1060"
    >
      <div
        id="liveToast"
        class="toast align-items-center text-bg-dark border-0"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="d-flex">
          <div class="toast-body fw-bold" id="toastMessage"></div>
          <button
            type="button"
            class="btn-close btn-close-white me-2 m-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="dashboard_parts/api.js"></script>
    <script src="rancho.js"></script>
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("sw.js")
          .catch((err) => console.log("Erro SW:", err));
      }
    </script>
  </body>
</html>
